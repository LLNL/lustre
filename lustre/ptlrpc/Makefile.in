MODULES := ptlrpc
LDLM := @top_srcdir@/lustre/ldlm/
TARGET := @top_srcdir@/lustre/target/

ldlm_objs := $(LDLM)l_lock.o $(LDLM)ldlm_lock.o
ldlm_objs += $(LDLM)ldlm_resource.o $(LDLM)ldlm_lib.o
ldlm_objs += $(LDLM)ldlm_plain.o $(LDLM)ldlm_extent.o
ldlm_objs += $(LDLM)ldlm_request.o $(LDLM)ldlm_lockd.o
ldlm_objs += $(LDLM)ldlm_flock.o $(LDLM)ldlm_inodebits.o
ldlm_objs += $(LDLM)ldlm_pool.o $(LDLM)interval_tree.o
ldlm_objs += $(LDLM)ldlm_reclaim.o
ptlrpc_objs := client.o recover.o connection.o niobuf.o pack_generic.o
ptlrpc_objs += events.o ptlrpc_module.o service.o pinger.o
ptlrpc_objs += llog_net.o llog_client.o llog_server.o import.o ptlrpcd.o
ptlrpc_objs += pers.o lproc_ptlrpc.o wiretest.o layout.o
ptlrpc_objs += sec.o sec_ctx.o sec_bulk.o sec_gc.o sec_config.o sec_lproc.o
ptlrpc_objs += sec_null.o sec_plain.o nrs.o nrs_fifo.o nrs_crr.o nrs_orr.o
ptlrpc_objs += errno.o

target_objs := $(TARGET)tgt_main.o $(TARGET)tgt_lastrcvd.o
target_objs += $(TARGET)tgt_handler.o $(TARGET)out_handler.o

ptlrpc-objs := $(ldlm_objs) $(ptlrpc_objs)
@SERVER_TRUE@ptlrpc-objs += $(target_objs)

@GSS_TRUE@subdir-m += gss

default: all

ldlm_%.c: @LUSTRE@/ldlm/ldlm_%.c
	ln -sf $< $@

l_lock.c: @LUSTRE@/ldlm/l_lock.c
	ln -sf $< $@

interval_tree.c: @LUSTRE@/ldlm/interval_tree.c
	ln -sf $< $@

tgt_%.c: @LUSTRE@/target/tgt_%.c
	ln -sf $< $@

EXTRA_DIST := $(ptlrpc_objs:.o=.c) ptlrpc_internal.h
EXTRA_DIST += $(TARGET)tgt_internal.h
@SERVER_FALSE@EXTRA_DIST += $(target_objs:.o=.c)

EXTRA_PRE_CFLAGS := -I@LUSTRE@/ldlm -I@LUSTRE@/target

@INCLUDE_RULES@
